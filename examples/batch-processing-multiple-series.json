{
  "name": "Batch Processing - Multiple Time Series",
  "nodes": [
    {
      "parameters": {},
      "id": "1",
      "name": "Start",
      "type": "n8n-nodes-base.start",
      "typeVersion": 1,
      "position": [50, 100]
    },
    {
      "parameters": {
        "jsonData": "{\n  \"multipleSeries\": [\n    [100, 101, 102, 103, 104, 105],\n    [200, 202, 204, 206, 208, 210],\n    [50, 51, 50, 51, 52, 51]\n  ]\n}"
      },
      "id": "2",
      "name": "3 Time Series (Batch)",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [200, 100]
    },
    {
      "parameters": {
        "model": "tirex",
        "modelVersion": "1",
        "inputData": "={{ $json.multipleSeries }}",

        "horizon": 3,
        "outputType": "point",
        "authentication": "faimApi"
      },
      "id": "3",
      "name": "FAIM Batch Forecast",
      "type": "@faim-group/n8n-nodes-faim.faimForecast",
      "typeVersion": 1,
      "position": [400, 100],
      "credentials": {
        "faimApi": {
          "id": "faim_key_1",
          "name": "FAIM API Key"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Extract results for each batch item (series)\nconst forecasts = $json.forecast.point;  // Shape: (batchSize=3, horizon=3)\nconst results = [];\n\nfor (let i = 0; i < forecasts.length; i++) {\n  const series = forecasts[i];  // forecast for series i\n  results.push({\n    \"seriesId\": i + 1,\n    \"forecast\": series,  // Array of 3 forecast values\n    \"nextValue\": series[0],  // First forecast timestep\n    \"trend\": series[series.length - 1] > series[0] ? \"increasing\" : \"decreasing\"\n  });\n}\n\nreturn results;"
      },
      "id": "4",
      "name": "Process Batch Results",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [600, 100]
    },
    {
      "parameters": {
        "content": "### Batch Forecast Results\n\n**Batch Size**: {{ $json.length }} time series\n**Model**: TiRex\n**Horizon**: 3 steps\n**Total Cost**: {{ $json[0].metadata.costAmount }} {{ $json[0].metadata.costCurrency }} (single batch call)\n\n**Results**:\n{{ JSON.stringify($json, null, 2) }}\n\n**Key Benefit**: All 3 forecasts processed in ONE API call (more efficient than 3 separate calls)"
      },
      "id": "5",
      "name": "Display Batch Results",
      "type": "n8n-nodes-base.html",
      "typeVersion": 1,
      "position": [800, 100]
    },
    {
      "parameters": {
        "jsCode": "// Mock batch forecasts for 3 series\nconst mockForecasts = [\n  [106, 107, 108],  // Series 1: continuation of uptrend\n  [212, 214, 216],  // Series 2: continuation of uptrend\n  [52, 51, 52]      // Series 3: continuing oscillation\n];\n\nconst results = [];\nfor (let i = 0; i < mockForecasts.length; i++) {\n  const series = mockForecasts[i];\n  results.push({\n    \"seriesId\": i + 1,\n    \"forecast\": series,\n    \"nextValue\": series[0],\n    \"trend\": series[series.length - 1] > series[0] ? \"increasing\" : \"decreasing\"\n  });\n}\n\nreturn results;"
      },
      "id": "6",
      "name": "Mock Batch Forecasts",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [600, 200]
    },
    {
      "parameters": {
        "content": "### Batch Processing Benefits\n\n**What is batch processing?**\nSending multiple time series in a single API call instead of making separate requests for each series.\n\n**Example**: \n- Series 1: [100, 101, 102, 103, 104, 105]\n- Series 2: [200, 202, 204, 206, 208, 210]\n- Series 3: [50, 51, 50, 51, 52, 51]\n\n**Results in parallel forecasts**:\n- Series 1 → [106, 107, 108]\n- Series 2 → [212, 214, 216]\n- Series 3 → [52, 51, 52]\n\n**Efficiency**: Single API call costs less than 3 separate calls and processes faster!"
      },
      "id": "7",
      "name": "Documentation",
      "type": "n8n-nodes-base.html",
      "typeVersion": 1,
      "position": [1000, 100]
    }
  ],
  "connections": {
    "Start": {
      "main": [
        [
          {
            "node": "3 Time Series (Batch)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "3 Time Series (Batch)": {
      "main": [
        [
          {
            "node": "FAIM Batch Forecast",
            "type": "main",
            "index": 0
          },
          {
            "node": "Mock Batch Forecasts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FAIM Batch Forecast": {
      "main": [
        [
          {
            "node": "Process Batch Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mock Batch Forecasts": {
      "main": [
        [
          {
            "node": "Display Batch Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Batch Results": {
      "main": [
        [
          {
            "node": "Display Batch Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Display Batch Results": {
      "main": [
        [
          {
            "node": "Documentation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {},
  "staticData": null,
  "createdAt": "2024-11-06T00:00:00.000Z",
  "id": "batch-processing",
  "versionId": "1"
}